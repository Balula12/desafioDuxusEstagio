<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Desafio Duxus - Cadastro e Montagem de Times</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; }
        h2 { margin-top: 40px; }
        label { display: block; margin-top: 10px; }
        input, select, button { margin-top: 5px; }
        .section { border: 1px solid #ccc; padding: 20px; margin-bottom: 30px; border-radius: 8px; }
        .list { margin-top: 10px; }
        .success { color: green; }
        .error { color: red; }
    </style>
</head>
<body>
    <h1>Desafio Duxus - Cadastro e Montagem de Times</h1>

    <div class="section">
        <h2>Cadastro de Integrante</h2>
        <form id="form-integrante">
            <label>Nome: <input type="text" id="nome-integrante" required></label>
            <label>Franquia: <input type="text" id="franquia-integrante" required></label>
            <label>Função: <input type="text" id="funcao-integrante" required></label>
            <button type="submit">Cadastrar Integrante</button>
        </form>
        <div id="msg-integrante"></div>
    </div>

    <div class="section">
        <h2>Listar Integrantes</h2>
        <button onclick="listarIntegrantes()">Atualizar Lista</button>
        <ul id="lista-integrantes" class="list"></ul>
    </div>

    <div class="section">
        <h2>Cadastro de Time</h2>
        <form id="form-time">
            <label>Data: <input type="date" id="data-time" required></label>
            <label>Integrantes:
                <select id="integrantes-time" multiple size="5" required style="width: 200px;"></select>
            </label>
            <button type="submit">Cadastrar Time</button>
        </form>
        <div id="msg-time"></div>
    </div>

    <div class="section">
        <h2>Listar Times</h2>
        <button onclick="listarTimes()">Atualizar Lista</button>
        <ul id="lista-times" class="list"></ul>
    </div>

    <script>
        const api = '';

        // Cadastro de Integrante
        document.getElementById('form-integrante').onsubmit = async function(e) {
            e.preventDefault();
            const nome = document.getElementById('nome-integrante').value;
            const franquia = document.getElementById('franquia-integrante').value;
            const funcao = document.getElementById('funcao-integrante').value;
            const resp = await fetch(api + '/integrantes', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ nome, franquia, funcao })
            });
            if (resp.ok) {
                document.getElementById('msg-integrante').innerHTML = '<span class="success">Integrante cadastrado!</span>';
                document.getElementById('form-integrante').reset();
                listarIntegrantes();
                atualizarSelectIntegrantes();
            } else {
                document.getElementById('msg-integrante').innerHTML = '<span class="error">Erro ao cadastrar integrante.</span>';
            }
        };

        // Listar Integrantes
        async function listarIntegrantes() {
            const resp = await fetch(api + '/integrantes');
            const lista = document.getElementById('lista-integrantes');
            lista.innerHTML = '';
            if (resp.ok) {
                const integrantes = await resp.json();
                integrantes.forEach(i => {
                    const li = document.createElement('li');
                    li.textContent = `#${i.id} - ${i.nome} (${i.franquia}, ${i.funcao})`;
                    lista.appendChild(li);
                });
            }
        }

        // Atualizar select de integrantes no cadastro de time
        async function atualizarSelectIntegrantes() {
            const resp = await fetch(api + '/integrantes');
            const select = document.getElementById('integrantes-time');
            select.innerHTML = '';
            if (resp.ok) {
                const integrantes = await resp.json();
                integrantes.forEach(i => {
                    const option = document.createElement('option');
                    option.value = i.id;
                    option.textContent = `#${i.id} - ${i.nome} (${i.franquia}, ${i.funcao})`;
                    select.appendChild(option);
                });
            }
        }

        // Cadastro de Time
        document.getElementById('form-time').onsubmit = async function(e) {
            e.preventDefault();
            const data = document.getElementById('data-time').value;
            const select = document.getElementById('integrantes-time');
            const selectedIds = Array.from(select.selectedOptions).map(opt => Number(opt.value));
            const respIntegrantes = await fetch(api + '/integrantes');
            const todosIntegrantes = respIntegrantes.ok ? await respIntegrantes.json() : [];
            const integrantesSelecionados = todosIntegrantes.filter(i => selectedIds.includes(i.id));
            const resp = await fetch(api + '/times', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ data, integrantes: integrantesSelecionados })
            });
            if (resp.ok) {
                document.getElementById('msg-time').innerHTML = '<span class="success">Time cadastrado!</span>';
                document.getElementById('form-time').reset();
                listarTimes();
            } else {
                document.getElementById('msg-time').innerHTML = '<span class="error">Erro ao cadastrar time.</span>';
            }
        };

        // Listar Times
        async function listarTimes() {
            const resp = await fetch(api + '/times');
            const lista = document.getElementById('lista-times');
            lista.innerHTML = '';
            if (resp.ok) {
                const times = await resp.json();
                times.forEach(t => {
                    const li = document.createElement('li');
                    const nomes = t.composicaoTime.map(c => c.integrante.nome).join(', ');
                    li.textContent = `#${t.id} - Data: ${t.data} | Integrantes: ${nomes}`;
                    lista.appendChild(li);
                });
            }
        }

        // Inicialização
        listarIntegrantes();
        atualizarSelectIntegrantes();
        listarTimes();
    </script>
</body>
</html> 